<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailor√© | Not Just Style, A Signature</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        /* --- CASSIUS-STYLE CHERRY, GREEN, BLUSH PALETTE --- */
        :root {
            /* Core brand colors */
            --tyrian: #9B1C2C; /* Cherry red */
            --citron: #0F5C3E; /* Forest green */

            /* Neutrals and surfaces */
            --cream: #FBF5EF; /* Soft cream background */
            --beige: #E9D9CF; /* Warm border */
            --putih: #ffffff;
            --dark-text: #3B2822; /* Cocoa brown text */
            --light-text: #8C756B;

            /* Extra tokens used elsewhere in the page */
            --hitam: #1B1B1B;
            --pink-soft: #FCE7EC; /* Blush backdrop */
            --pink-neon: #E04C67; /* Accent pink */
            --yellow: #F0D27A;
            --abu: #F4F2F0;
            --gradient-3: linear-gradient(135deg, #E04C67, #9B1C2C);
            --gradient-5: linear-gradient(135deg, #F7C6D0, #FDE7EF);
        }

        /* RESET */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { 
            background: var(--cream);
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(155, 28, 44, 0.02) 35px, rgba(155, 28, 44, 0.02) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(15, 92, 62, 0.02) 35px, rgba(15, 92, 62, 0.02) 70px);
            color: var(--dark-text); 
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }

        /* HEADER */
        header { 
            background: var(--pink-soft);
            color: var(--dark-text); 
            padding: 1.5rem 0; 
            border-bottom: 3px solid var(--tyrian);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 { 
            font-family: 'Great Vibes', 'Cormorant Garamond', serif;
            font-weight: 600; 
            letter-spacing: 1px; 
            text-transform: none; 
            font-size: 2.6rem;
            color: var(--tyrian);
        }
        header span { 
            color: var(--tyrian);
        }

        .auth-section {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .user-info {
            color: var(--light-text);
            font-weight: 500;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-header {
            padding: 0.65rem 2rem;
            background: var(--citron);
            color: var(--putih);
            border: 2px solid var(--citron);
            font-weight: 500;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1.5px;
            transition: all 0.3s ease;
            border-radius: 25px;
            box-shadow: 0 3px 10px rgba(15, 92, 62, 0.3);
        }

        .btn-header:hover {
            background: var(--tyrian);
            color: var(--putih);
            border-color: var(--tyrian);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 28, 44, 0.4);
        }

        /* CONTAINER */
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 2rem;
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            width: fit-content;
            background: var(--putih);
            padding: 0.5rem;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(155, 28, 44, 0.1);
        }

        .tab {
            padding: 0.8rem 2.5rem;
            background: transparent;
            color: var(--light-text);
            border: none;
            font-weight: 500;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1.5px;
            transition: all 0.3s ease;
            border-radius: 30px;
            position: relative;
            white-space: nowrap;
        }

        .tab.active {
            background: var(--tyrian);
            color: var(--putih);
            box-shadow: 0 4px 15px rgba(155, 28, 44, 0.3);
        }

        .tab:hover:not(.active) {
            background: var(--pink-soft);
            color: var(--tyrian);
        }

        /* CARD */
        .card { 
            background: var(--putih);
            border: 1px solid var(--beige);
            padding: 3rem; 
            box-shadow: 0 10px 40px rgba(155, 28, 44, 0.1), 0 4px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            border-radius: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(155, 28, 44, 0.03) 0%, transparent 70%);
            pointer-events: none;
        }

        .card:hover {
            box-shadow: 0 15px 50px rgba(155, 28, 44, 0.15), 0 8px 20px rgba(0,0,0,0.08);
            transform: translateY(-3px);
        }

        .card h3 { 
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem; 
            margin-bottom: 2rem; 
            color: var(--tyrian);
            border-bottom: 1px solid var(--beige);
            padding-bottom: 0.8rem; 
            text-transform: uppercase; 
            font-weight: 600;
            letter-spacing: 2px;
        }
        

        /* SEARCH & FILTERS */
        .search-section {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .form-group { margin-bottom: 1.2rem; }
        label { 
            display: block; 
            margin-bottom: 0.6rem; 
            font-weight: 500; 
            font-size: 0.8rem;
            color: var(--light-text);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        input, select { 
            width: 100%; 
            padding: 0.9rem 1rem;
            border: 2px solid var(--beige);
            background: var(--cream);
            font-size: 0.95rem; 
            font-weight: 400;
            transition: all 0.3s ease;
            border-radius: 12px;
            color: var(--dark-text);
        }

        input::placeholder {
            color: var(--light-text);
        }

        input:focus, select:focus { 
            outline: none; 
            border-color: var(--tyrian);
            background: var(--putih);
        }

        /* PRODUCTS GRID */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
            align-items: stretch;
        }

        .product-card {
            background: var(--putih);
            border: 2px solid var(--beige);
            box-shadow: 0 5px 20px rgba(155, 28, 44, 0.08);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
            border-radius: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .product-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--tyrian), var(--citron));
        }

        .product-card:hover {
            transform: translateY(-10px) rotate(-1deg);
            box-shadow: 0 15px 40px rgba(155, 28, 44, 0.2), 0 5px 15px rgba(15, 92, 62, 0.1);
            border-color: var(--tyrian);
        }

        .product-image {
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, var(--pink-soft) 0%, var(--beige) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            border-radius: 20px 20px 0 0;
        }
        
        .product-image::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, transparent 0%, rgba(155, 28, 44, 0.1) 100%);
            z-index: 1;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.5s ease;
        }
        
        .product-card:hover .product-image img {
            transform: scale(1.1);
        }

        .stock-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--tyrian);
            color: var(--putih);
            padding: 6px 14px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            border: none;
            border-radius: 0;
        }

        .out-of-stock-badge {
            background: var(--dark-text);
        }

        .low-stock {
            background: var(--citron);
            color: var(--dark-text);
        }

        .product-info {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .product-brand {
            font-size: 0.7rem;
            color: var(--light-text);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.8rem;
            color: var(--tyrian);
            line-height: 1.4;
            min-height: 2.8rem;
        }
        
        .product-info > button,
        .product-info > div:last-child {
            margin-top: auto;
        }

        .product-meta {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 4px 10px;
            font-size: 0.65rem;
            background: #F8E1E8;
            color: var(--dark-text);
            font-weight: 500;
            text-transform: uppercase;
            border-radius: 0;
            letter-spacing: 1px;
        }

        .badge.stock-low { 
            background: var(--gradient-5);
            box-shadow: 0 2px 10px rgba(250, 112, 154, 0.4);
        }
        .badge.stock-out { 
            background: var(--dark-text);
            color: var(--putih);
        }

        .product-price {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--tyrian);
            margin-bottom: 0.5rem;
        }

        .product-stock {
            font-size: 0.8rem;
            color: var(--light-text);
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .stock-available { 
            color: var(--citron);
        }
        .stock-low { 
            color: var(--light-text);
        }
        .stock-out { 
            color: var(--tyrian);
        }

        /* BUTTONS */
        button { 
            width: 100%; 
            padding: 1rem; 
            background: var(--tyrian);
            color: var(--putih); 
            border: 2px solid var(--tyrian); 
            font-size: 0.8rem; 
            font-weight: 600; 
            cursor: pointer; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            transition: all 0.3s ease;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(155, 28, 44, 0.3);
        }

        button:hover { 
            background: var(--citron);
            border-color: var(--citron);
            color: var(--putih);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(15, 92, 62, 0.4);
        }

        button:disabled {
            background: var(--beige);
            border-color: var(--beige);
            color: var(--light-text);
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-secondary { 
            background: var(--putih);
            color: var(--dark-text);
            border: 1px solid var(--beige);
            backdrop-filter: none;
        }

        .btn-secondary:hover {
            background: var(--beige);
            border-color: var(--beige);
        }

        .btn-refresh { 
            background: var(--citron);
            color: var(--putih);
            border: 2px solid var(--citron); 
            width: auto; 
            padding: 0.7rem 1.8rem; 
            font-size: 0.85rem;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(15, 92, 62, 0.3);
            border-radius: 25px;
            position: relative;
            top: 0;
            transition: all 0.3s ease;
        }
        
        .btn-refresh:hover { 
            background: var(--tyrian);
            color: var(--putih); 
            border-color: var(--tyrian);
            box-shadow: 0 6px 20px rgba(155, 28, 44, 0.4);
            transform: translateY(-2px);
        }

        /* TABLE */
        .table-responsive { 
            overflow-x: auto;
            border: 1px solid var(--beige);
            border-radius: 0;
            background: var(--putih);
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 0.85rem; 
        }

        th { 
            background: var(--beige);
            color: var(--tyrian); 
            padding: 1rem; 
            text-align: left; 
            text-transform: uppercase; 
            font-size: 0.7rem; 
            letter-spacing: 2px;
            font-weight: 600;
        }

        td { 
            padding: 1rem; 
            border-bottom: 1px solid var(--beige);
            background: var(--putih);
            font-weight: 400;
            color: var(--dark-text);
        }

        tr:nth-child(even) td { 
            background: rgba(202, 209, 131, 0.05);
        }

        tr:hover td {
            background: rgba(202, 209, 131, 0.15);
        }

        /* PAGINATION */
        .pagination {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin: 3rem 0 2rem;
        }

        .pagination button {
            width: auto;
            min-width: 50px;
            padding: 0.8rem 1.2rem;
            font-size: 0.85rem;
            font-weight: 600;
            background: var(--putih);
            border: 2px solid var(--dark-text);
            transition: all 0.3s ease;
            border-radius: 0;
            color: var(--dark-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pagination button:hover:not(.active):not(:disabled) {
            background: var(--pink-soft);
            border-color: var(--tyrian);
            color: var(--tyrian);
        }

        .pagination button.active {
            background: var(--tyrian);
            color: var(--putih);
            border-color: var(--tyrian);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--beige);
            border-color: var(--beige);
            color: var(--light-text);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--putih);
            border: 3px solid var(--tyrian);
            box-shadow: 0 20px 80px rgba(155, 28, 44, 0.3), 0 10px 30px rgba(0,0,0,0.2);
            max-width: 1000px;
            width: 90%;
            max-height: 90vh;
            overflow: hidden;
            padding: 0;
            border-radius: 30px;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, var(--pink-soft) 0%, var(--cream) 100%);
            border-bottom: 3px solid var(--tyrian);
            position: relative;
            flex-shrink: 0;
        }
        
        .modal-body {
            overflow-y: auto;
            padding: 2rem;
            flex: 1;
        }
        
        .modal-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: var(--cream);
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: var(--tyrian);
            border-radius: 4px;
        }
        
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: var(--citron);
        }
        
        .modal-header::before {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 30%;
            height: 3px;
            background: var(--citron);
        }

        .modal-header h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin: 0;
            border: none;
            padding: 0;
            color: var(--tyrian);
            letter-spacing: 2px;
        }

        .close-btn {
            background: transparent;
            color: var(--tyrian);
            border: none;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            font-weight: 400;
            padding: 0;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            transform: rotate(90deg);
        }

        /* QUANTITY SELECTOR */
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 0 auto 1.5rem;
            width: fit-content;
            position: relative;
        }

        .quantity-selector button {
            background: var(--tyrian);
            color: var(--putih);
            border: none;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 50%;
            box-shadow: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-selector button:hover {
            background: var(--citron);
            transform: scale(1.15);
        }

        .quantity-selector button:disabled {
            background: var(--beige);
            color: var(--light-text);
            cursor: not-allowed;
            transform: none;
        }

        .quantity-selector input {
            width: 60px;
            height: 40px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            border: 2px solid var(--tyrian);
            padding: 0;
            background: var(--putih);
            border-radius: 20px;
            color: var(--tyrian);
            margin: 0 0.5rem;
        }

        .btn-checkout {
            width: 100%;
            padding: 1.2rem;
            background: var(--tyrian);
            color: var(--putih);
            border: 2px solid var(--tyrian);
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(155, 28, 44, 0.3);
        }

        .btn-checkout:hover {
            background: var(--citron);
            border-color: var(--citron);
            color: var(--putih);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(15, 92, 62, 0.4);
        }

        .btn-checkout:disabled {
            background: var(--beige);
            border-color: var(--beige);
            color: var(--light-text);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 4rem;
            font-weight: 500;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: var(--tyrian);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* ALERT */
        .alert {
            padding: 1.2rem 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid;
            font-weight: 500;
            font-size: 0.85rem;
            position: fixed;
            top: 100px;
            right: 2rem;
            z-index: 99999;
            max-width: 400px;
            min-width: 300px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-radius: 0;
            background: var(--putih);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(500px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .alert-success {
            color: var(--citron);
            border-color: var(--citron);
        }

        .alert-error {
            color: var(--tyrian);
            border-color: var(--tyrian);
        }

        .alert-info {
            color: var(--dark-text);
            border-color: var(--dark-text);
        }

        /* STATS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--putih);
            color: var(--dark-text);
            padding: 2rem;
            border: 1px solid var(--beige);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 0;
            position: relative;
            border-top: 3px solid var(--tyrian);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--light-text);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }

        .stat-value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.2rem;
            font-weight: 600;
            color: var(--tyrian);
        }

        /* STATUS BADGE */
        .status-badge {
            background: var(--citron);
            color: var(--putih);
            padding: 5px 12px;
            font-size: 0.7rem;
            text-transform: uppercase;
            font-weight: 600;
            border: none;
            display: inline-block;
            border-radius: 0;
            letter-spacing: 1px;
        }

        /* Override inline debug styles on pagination container */
        #pagination {
            background: transparent !important;
            border: none !important;
            min-height: 0 !important;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .search-section {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }

            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .tabs {
                width: 100%;
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
            }
        }

        /* FLOATING CART BUTTON */
        .floating-cart-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--tyrian);
            color: var(--putih);
            width: 65px;
            height: 65px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: 0 4px 20px rgba(102, 2, 60, 0.3);
            border: none;
            cursor: pointer;
            z-index: 999;
            transition: all 0.3s ease;
        }

        .floating-cart-btn:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 30px rgba(102, 2, 60, 0.5);
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--citron);
            color: var(--dark-text);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            border: 2px solid var(--putih);
        }

        /* HIDDEN */
        .hidden {
            display: none !important;
        }

        /* FOOTER */
        footer { 
            text-align: center; 
            padding: 3rem 2rem; 
            color: var(--light-text);
            font-weight: 400; 
            font-size: 0.8rem;
            letter-spacing: 1px;
            background: var(--putih);
            margin-top: 4rem;
            border-top: 1px solid var(--beige);
        }
    </style>
</head>
<body>

    <header>
        <div class="header-container">
            <h1>Tailor√©<span>.</span></h1>
            <div class="auth-section">
                <div class="user-info" id="userInfo">GUEST</div>
                <button class="btn-header" id="authBtn" onclick="showLoginModal()">LOGIN</button>
            </div>
        </div>
    </header>

    <div class="container">
        
        <!-- USER TABS -->
        <div class="tabs" id="userTabs">
            <button class="tab active" onclick="switchTab('catalog')">CATALOG</button>
            <button class="tab" onclick="switchTab('history')">ORDER HISTORY</button>
        </div>

        <!-- ADMIN TABS -->
        <div class="tabs hidden" id="adminTabs">
            <button class="tab active" onclick="switchTab('catalog')">CATALOG</button>
            <button class="tab" onclick="switchTab('inventory')">INVENTORY</button>
            <button class="tab" onclick="switchTab('transactions')">TRANSACTION HISTORY</button>
        </div>

        <!-- ALERT AREA -->
        <div id="alertArea"></div>

        <!-- CATALOG TAB -->
        <div id="catalogTab" class="tab-content">
            <div class="card">
                <h3>Explore Products</h3>
                
                <div class="search-section">
                    <div class="form-group">
                        <label>SEARCH</label>
                        <input type="text" id="searchInput" placeholder="SEARCH BY NAME, BRAND, DESCRIPTION...">
                    </div>
                    
                    <div class="form-group">
                        <label>BRAND</label>
                        <select id="brandFilter">
                            <option value="">ALL BRANDS</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>CATEGORY</label>
                        <select id="categoryFilter">
                            <option value="">ALL CATEGORIES</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>COLOR</label>
                        <select id="colorFilter">
                            <option value="">ALL COLORS</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <button onclick="applyFilters()" style="flex: 1;">APPLY FILTERS</button>
                    <button onclick="resetFilters()" class="btn-secondary" style="flex: 1;">RESET</button>
                </div>
            </div>

            <!-- PRODUCTS GRID -->
            <div id="productsContainer">
                <div class="loading">LOADING PRODUCTS</div>
            </div>

            <!-- PAGINATION - ALWAYS VISIBLE CONTAINER -->
            <div class="pagination" id="pagination">
            </div>
        </div>

        <!-- INVENTORY TAB (Admin Only) -->
        <div id="inventoryContent" class="tab-content hidden">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Products</div>
                    <div class="stat-value" id="statTotal">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Low Stock</div>
                    <div class="stat-value" id="statLowStock">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Out of Stock</div>
                    <div class="stat-value" id="statOutOfStock">0</div>
                </div>
            </div>

            <div class="card">
                <h3>Stock Management</h3>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>PRODUCT</th>
                                <th>BRAND</th>
                                <th>SIZE</th>
                                <th>TOTAL QTY</th>
                                <th>AVAILABLE</th>
                                <th>RESERVED</th>
                                <th>ACTION</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <tr><td colspan="7" class="loading">LOADING INVENTORY</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- CHECKOUT PAGE -->
        <div id="checkoutPage" class="tab-content hidden">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="margin: 0;">CHECKOUT</h3>
                    <button onclick="backToCatalog()" class="btn-refresh">‚Üê BACK TO CATALOG</button>
                </div>

                <!-- ORDER SUMMARY -->
                <div style="background: var(--pink-soft); border: 2px solid var(--tyrian); padding: 2rem; margin-bottom: 2rem; box-shadow: 0 5px 20px rgba(155, 28, 44, 0.1); border-radius: 20px;">
                    <h4 style="font-weight: 700; margin-bottom: 1.5rem; text-transform: uppercase; border-bottom: 2px solid var(--tyrian); padding-bottom: 0.8rem; color: var(--tyrian); font-size: 0.9rem; letter-spacing: 2px;">ORDER SUMMARY</h4>
                    <div id="checkoutOrderSummary"></div>
                    <div style="border-top: 2px solid var(--tyrian); margin-top: 1.5rem; padding-top: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; font-weight: 700; font-size: 1.3rem;">
                            <span style="color: var(--dark-text);">TOTAL:</span>
                            <span id="checkoutTotal" style="color: var(--tyrian);">USD 0</span>
                        </div>
                    </div>
                </div>

                <!-- CUSTOMER INFORMATION -->
                <div style="background: var(--putih); border: 2px solid var(--beige); padding: 2rem; margin-bottom: 2rem; box-shadow: 0 5px 20px rgba(155, 28, 44, 0.08); border-radius: 20px;">
                    <h4 style="font-weight: 700; margin-bottom: 1.5rem; text-transform: uppercase; border-bottom: 2px solid var(--tyrian); padding-bottom: 0.8rem; color: var(--tyrian); font-size: 0.9rem; letter-spacing: 2px;">CUSTOMER INFORMATION</h4>
                    
                    <div style="margin-bottom: 1.2rem;">
                        <label style="display: block; margin-bottom: 0.6rem; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; color: var(--light-text); letter-spacing: 1.5px;">CUSTOMER NAME</label>
                        <input type="text" id="checkoutCustomerName" readonly style="width: 100%; padding: 0.9rem 1rem; border: 2px solid var(--beige); background: var(--cream); font-weight: 500; border-radius: 12px;">
                    </div>

                    <div style="margin-bottom: 1.2rem;">
                        <label style="display: block; margin-bottom: 0.6rem; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; color: var(--light-text); letter-spacing: 1.5px;">PHONE NUMBER</label>
                        <input type="tel" id="checkoutPhone" placeholder="ENTER YOUR PHONE NUMBER" style="width: 100%; padding: 0.9rem 1rem; border: 2px solid var(--beige); background: var(--cream); font-weight: 500; border-radius: 12px;">
                    </div>

                    <div style="margin-bottom: 1.2rem;">
                        <label style="display: block; margin-bottom: 0.6rem; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; color: var(--light-text); letter-spacing: 1.5px;">DELIVERY ADDRESS</label>
                        <textarea id="checkoutAddress" placeholder="ENTER YOUR FULL ADDRESS" rows="3" style="width: 100%; padding: 0.9rem 1rem; border: 2px solid var(--beige); background: var(--cream); font-weight: 500; font-family: 'Inter', sans-serif; resize: vertical; border-radius: 12px;"></textarea>
                    </div>

                    <div style="margin-bottom: 1.2rem;">
                        <label style="display: block; margin-bottom: 0.6rem; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; color: var(--light-text); letter-spacing: 1.5px;">PAYMENT METHOD</label>
                        <select id="checkoutPayment" style="width: 100%; padding: 0.9rem 1rem; border: 2px solid var(--beige); background: var(--cream); font-weight: 500; border-radius: 12px;">
                            <option value="credit_card">CREDIT CARD</option>
                            <option value="bank_transfer">BANK TRANSFER</option>
                            <option value="e_wallet">E-WALLET</option>
                            <option value="cash_on_delivery">CASH ON DELIVERY</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 1.2rem;">
                        <label style="display: block; margin-bottom: 0.6rem; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; color: var(--light-text); letter-spacing: 1.5px;">ORDER NOTES (OPTIONAL)</label>
                        <textarea id="checkoutNotes" placeholder="ADD ANY SPECIAL INSTRUCTIONS" rows="2" style="width: 100%; padding: 0.9rem 1rem; border: 2px solid var(--beige); background: var(--cream); font-weight: 500; font-family: 'Inter', sans-serif; resize: vertical; border-radius: 12px;"></textarea>
                    </div>
                </div>

                <!-- ACTION BUTTONS -->
                <button onclick="confirmCheckout()" id="btnConfirmCheckout" style="width: 100%;">CONFIRM ORDER</button>
                
                <div id="checkoutStatus" style="margin-top: 1rem; text-align: center; font-weight: bold;"></div>
            </div>
        </div>

        <!-- ORDER HISTORY TAB (USER) -->
        <div id="historyTab" class="tab-content hidden">
            <div class="card">
                <h3>MY ORDER HISTORY</h3>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>INVOICE</th>
                                <th>PRODUCT NAME</th>
                                <th>PRODUCT ID</th>
                                <th>QTY</th>
                                <th>TOTAL</th>
                                <th>STATUS</th>
                                <th>DATE</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody">
                            <tr><td colspan="7" class="loading">PLEASE LOGIN TO VIEW HISTORY</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TRANSACTION HISTORY TAB (ADMIN) -->
        <div id="transactionsTab" class="tab-content hidden">
            <div class="card">
                <h3>ALL TRANSACTIONS</h3>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>INVOICE</th>
                                <th>CUSTOMER</th>
                                <th>PRODUCT NAME</th>
                                <th>PRODUCT ID</th>
                                <th>QTY</th>
                                <th>TOTAL</th>
                                <th>STATUS</th>
                                <th>DATE</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody">
                            <tr><td colspan="8" class="loading">LOADING TRANSACTIONS</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- FLOATING CART BUTTON (USER ONLY) -->
    <div class="floating-cart-btn" id="floatingCartBtn" onclick="showCartModal()">
        üõí
        <div class="cart-badge" id="cartCount">0</div>
    </div>

    <!-- LOGIN MODAL -->
    <div class="modal" id="loginModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="padding: 2rem 2.5rem;">
                <h3 style="font-size: 2.2rem;">LOGIN</h3>
                <button class="close-btn" onclick="closeModal('loginModal')">√ó</button>
            </div>
            <div class="modal-body" style="padding: 2.5rem;">
                <div class="form-group" style="margin-bottom: 1.8rem;">
                    <label style="font-size: 0.85rem; margin-bottom: 0.8rem;">USERNAME</label>
                    <input type="text" id="loginUsername" placeholder="ENTER USERNAME" style="font-size: 1.05rem; padding: 1.2rem 1.5rem; border-radius: 15px; border: 2px solid var(--beige);">
                </div>
                <div class="form-group" style="margin-bottom: 1.8rem;">
                    <label style="font-size: 0.85rem; margin-bottom: 0.8rem;">PASSWORD</label>
                    <input type="password" id="loginPassword" placeholder="ENTER PASSWORD" style="font-size: 1.05rem; padding: 1.2rem 1.5rem; border-radius: 15px; border: 2px solid var(--beige);">
                </div>
                <button onclick="login()" style="margin-top: 1rem; padding: 1.3rem; font-size: 0.95rem; border-radius: 18px;">LOGIN NOW</button>
                
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--beige); text-align: center;">
                    <p style="font-size: 0.9rem; color: var(--light-text); margin-bottom: 1rem; font-weight: 500;">
                        DON'T HAVE AN ACCOUNT?
                    </p>
                    <a href="#" onclick="event.preventDefault(); closeModal('loginModal'); showRegisterModal();" style="color: var(--tyrian); font-weight: 700; text-decoration: none; font-size: 1rem; display: inline-block; padding: 0.8rem 2rem; background: var(--pink-soft); border-radius: 12px; transition: all 0.3s ease; border: 2px solid transparent;" onmouseover="this.style.background='var(--tyrian)'; this.style.color='var(--putih)'; this.style.borderColor='var(--tyrian)';" onmouseout="this.style.background='var(--pink-soft)'; this.style.color='var(--tyrian)'; this.style.borderColor='transparent';">REGISTER HERE</a>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1.3rem 1.5rem; background: var(--cream); border-radius: 15px; border-left: 4px solid var(--citron);">
                    <p style="font-size: 0.85rem; color: var(--light-text); margin: 0; line-height: 1.6;">
                        <strong style="color: var(--citron); font-size: 0.9rem;">Demo Account:</strong><br>
                        <span style="color: var(--dark-text); font-weight: 600;">admin / admin123</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- REGISTER MODAL -->
    <div class="modal" id="registerModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header" style="padding: 2rem 2.5rem;">
                <h3 style="font-size: 2.2rem;">CREATE ACCOUNT</h3>
                <button class="close-btn" onclick="closeModal('registerModal')">√ó</button>
            </div>
            <div class="modal-body" style="padding: 2.5rem;">
                <div class="form-group" style="margin-bottom: 1.8rem;">
                    <label style="font-size: 0.85rem; margin-bottom: 0.8rem;">USERNAME</label>
                    <input type="text" id="registerUsername" placeholder="CHOOSE USERNAME" style="font-size: 1.05rem; padding: 1.2rem 1.5rem; border-radius: 15px; border: 2px solid var(--beige);">
                    <small style="display: block; margin-top: 0.7rem; font-size: 0.8rem; color: var(--light-text); font-weight: 500;">Choose a unique username (min. 3 characters)</small>
                </div>
                <div class="form-group" style="margin-bottom: 1.8rem;">
                    <label style="font-size: 0.85rem; margin-bottom: 0.8rem;">PASSWORD</label>
                    <input type="password" id="registerPassword" placeholder="CHOOSE PASSWORD" style="font-size: 1.05rem; padding: 1.2rem 1.5rem; border-radius: 15px; border: 2px solid var(--beige);">
                    <small style="display: block; margin-top: 0.7rem; font-size: 0.8rem; color: var(--light-text); font-weight: 500;">At least 6 characters required</small>
                </div>
                <div class="form-group" style="margin-bottom: 1.8rem;">
                    <label style="font-size: 0.85rem; margin-bottom: 0.8rem;">CONFIRM PASSWORD</label>
                    <input type="password" id="registerConfirmPassword" placeholder="CONFIRM PASSWORD" style="font-size: 1.05rem; padding: 1.2rem 1.5rem; border-radius: 15px; border: 2px solid var(--beige);">
                </div>
                <button onclick="register()" style="margin-top: 1rem; padding: 1.3rem; font-size: 0.95rem; border-radius: 18px;">CREATE ACCOUNT</button>
                
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid var(--beige); text-align: center;">
                    <p style="font-size: 0.9rem; color: var(--light-text); margin-bottom: 1rem; font-weight: 500;">
                        ALREADY HAVE AN ACCOUNT?
                    </p>
                    <a href="#" onclick="event.preventDefault(); closeModal('registerModal'); showLoginModal();" style="color: var(--citron); font-weight: 700; text-decoration: none; font-size: 1rem; display: inline-block; padding: 0.8rem 2rem; background: var(--cream); border-radius: 12px; border: 2px solid var(--citron); transition: all 0.3s ease;" onmouseover="this.style.background='var(--citron)'; this.style.color='var(--putih)';" onmouseout="this.style.background='var(--cream)'; this.style.color='var(--citron)';">LOGIN HERE</a>
                </div>
            </div>
        </div>
    </div>

    <!-- PRODUCT DETAIL MODAL -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>PRODUCT DETAILS</h3>
                <button class="close-btn" onclick="closeModal('productModal')">√ó</button>
            </div>
            <div class="modal-body" id="productDetailContent"></div>
        </div>
    </div>

    <!-- STOCK ADJUST MODAL -->
    <div class="modal" id="stockModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ADJUST STOCK</h3>
                <button class="close-btn" onclick="closeModal('stockModal')">√ó</button>
            </div>
            <div class="modal-body" id="stockAdjustContent"></div>
        </div>
    </div>

    <!-- CART MODAL -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>SHOPPING CART</h3>
                <button class="close-btn" onclick="closeModal('cartModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="cartItems" style="margin-bottom: 1.5rem; max-height: 400px; overflow-y: auto;">
                    <p style="text-align:center; color:#999;">Cart is empty.</p>
                </div>
                <div style="border-top: 2px solid var(--tyrian); padding-top: 1rem;">
                    <div style="display:flex; justify-content:space-between; font-weight:800; font-size:1.2rem; margin-bottom:1rem;">
                        <span>TOTAL:</span>
                        <span id="cartTotal">USD 0</span>
                    </div>
                    <button onclick="showCheckoutPage()" id="btnCheckout">PROCEED TO CHECKOUT</button>
                </div>
            </div>
        </div>
    </div>

    </div>

    <footer>
        &copy; 2026 TAILOR√â OFFICIAL STORE.
    </footer>

    <script>
        // CONFIG
        const CATALOG_API = "https://ooga.queenifyofficial.site/api";
        const ORDER_API = "https://cimol.queenifyofficial.site/api";

        // STATE
        let cart = JSON.parse(localStorage.getItem('tailore_cart') || '[]');
        let token = localStorage.getItem('token');
        let currentUser = localStorage.getItem('username');
        let userRole = localStorage.getItem('role') || 'user';
        let currentPage = 1;
        let currentFilters = {};
        let authToken = token;
        let userData = null;

        // INIT
        document.addEventListener('DOMContentLoaded', async () => {
            if (authToken) {
                await checkAuth();
            } else {
                updateAuthUI();
            }
            updateCartUI();
            await loadFilters();
            await loadProducts();
        });

        // AUTH
        async function checkAuth() {
            try {
                const response = await fetch(`${CATALOG_API}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    userData = data.data;
                    updateAuthUI();
                } else {
                    logout();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
            }
        }

        function updateAuthUI() {
            if (token || (userData && authToken)) {
                const username = currentUser || (userData && userData.username);
                const role = userRole || (userData && userData.role) || 'user';
                
                document.getElementById('userInfo').textContent = username ? username.toUpperCase() : 'USER';
                document.getElementById('authBtn').textContent = 'LOGOUT';
                document.getElementById('authBtn').onclick = logout;
                
                // Show/hide tabs and cart button based on role
                if (role === 'admin') {
                    document.getElementById('userTabs').classList.add('hidden');
                    document.getElementById('adminTabs').classList.remove('hidden');
                    document.getElementById('floatingCartBtn').style.display = 'none'; // ADMIN NO CART
                } else {
                    document.getElementById('userTabs').classList.remove('hidden');
                    document.getElementById('adminTabs').classList.add('hidden');
                    document.getElementById('floatingCartBtn').style.display = 'flex'; // USER HAS CART
                }
            } else {
                document.getElementById('userInfo').textContent = 'GUEST';
                document.getElementById('authBtn').textContent = 'LOGIN';
                document.getElementById('authBtn').onclick = showLoginModal;
                document.getElementById('userTabs').classList.remove('hidden');
                document.getElementById('adminTabs').classList.add('hidden');
                document.getElementById('floatingCartBtn').style.display = 'flex';
            }
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function showRegisterModal() {
            document.getElementById('registerModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function register() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            if (!username || !password || !confirmPassword) {
                showAlert('PLEASE FILL ALL FIELDS', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showAlert('PASSWORDS DO NOT MATCH', 'error');
                return;
            }

            if (password.length < 6) {
                showAlert('PASSWORD MUST BE AT LEAST 6 CHARACTERS', 'error');
                return;
            }

            try {
                const response = await fetch(`${CATALOG_API}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username, 
                        password,
                        role: 'user' // Always register as user
                    })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    closeModal('registerModal');
                    showAlert('ACCOUNT CREATED SUCCESSFULLY! PLEASE LOGIN', 'success');
                    
                    // Clear inputs
                    document.getElementById('registerUsername').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('registerConfirmPassword').value = '';
                    
                    // Show login modal
                    setTimeout(() => {
                        showLoginModal();
                    }, 1500);
                } else {
                    showAlert(data.message || 'REGISTRATION FAILED', 'error');
                }
            } catch (error) {
                showAlert('SERVER ERROR', 'error');
            }
        }

        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showAlert('PLEASE FILL ALL FIELDS', 'error');
                return;
            }

            try {
                const response = await fetch(`${CATALOG_API}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    authToken = data.data.token;
                    token = data.data.token;
                    userData = data.data.user;
                    currentUser = data.data.user.username;
                    userRole = data.data.user.role || 'user';
                    
                    localStorage.setItem('token', authToken);
                    localStorage.setItem('username', currentUser);
                    localStorage.setItem('role', userRole);
                    
                    closeModal('loginModal');
                    updateAuthUI();
                    showAlert('LOGIN SUCCESSFUL!', 'success');
                    
                    // Clear inputs
                    document.getElementById('loginUsername').value = '';
                    document.getElementById('loginPassword').value = '';
                } else {
                    showAlert(data.message || 'LOGIN FAILED', 'error');
                }
            } catch (error) {
                showAlert('SERVER ERROR', 'error');
            }
        }

        function logout() {
            authToken = null;
            token = null;
            userData = null;
            currentUser = null;
            userRole = 'user';
            cart = [];
            
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            localStorage.removeItem('role');
            localStorage.removeItem('tailore_cart');
            
            updateAuthUI();
            updateCartUI();
            switchTab('catalog');
            showAlert('LOGGED OUT SUCCESSFULLY', 'info');
        }

        // TABS
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            
            // Show selected tab
            if (tabName === 'catalog') {
                document.getElementById('catalogTab').classList.remove('hidden');
                document.querySelectorAll('button[onclick="switchTab(\'catalog\')"]').forEach(b => b.classList.add('active'));
            } else if (tabName === 'history') {
                document.getElementById('historyTab').classList.remove('hidden');
                document.querySelector('#userTabs button[onclick="switchTab(\'history\')"]').classList.add('active');
                loadHistory();
            } else if (tabName === 'inventory') {
                if(userRole !== 'admin' && (!userData || userData.role !== 'admin')) {
                    showAlert('ADMIN ACCESS REQUIRED', 'error');
                    return;
                }
                document.getElementById('inventoryContent').classList.remove('hidden');
                document.querySelector('#adminTabs button[onclick="switchTab(\'inventory\')"]').classList.add('active');
                loadInventory();
                loadStats();
            } else if (tabName === 'transactions') {
                if(userRole !== 'admin' && (!userData || userData.role !== 'admin')) {
                    showAlert('ADMIN ACCESS REQUIRED', 'error');
                    return;
                }
                document.getElementById('transactionsTab').classList.remove('hidden');
                document.querySelector('#adminTabs button[onclick="switchTab(\'transactions\')"]').classList.add('active');
                loadTransactions();
            }
        }

        // FILTERS
        async function loadFilters() {
            try {
                const response = await fetch(`${CATALOG_API}/catalog/filters`);
                const data = await response.json();

                if (data.success) {
                    // Populate filter dropdowns
                    populateSelect('brandFilter', data.data.brands);
                    populateSelect('categoryFilter', data.data.categories);
                    populateSelect('colorFilter', data.data.colors);
                }
            } catch (error) {
                console.error('Failed to load filters:', error);
            }
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            const firstOption = select.options[0].text;
            select.innerHTML = `<option value="">${firstOption}</option>`;
            
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option.toUpperCase();
                select.appendChild(opt);
            });
        }

        function applyFilters() {
            currentPage = 1;
            currentFilters = {
                search: document.getElementById('searchInput').value,
                brand: document.getElementById('brandFilter').value,
                category: document.getElementById('categoryFilter').value,
                color: document.getElementById('colorFilter').value
            };
            loadProducts();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('colorFilter').value = '';
            currentFilters = {};
            currentPage = 1;
            loadProducts();
        }

        // PRODUCTS
        async function loadProducts() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="loading">LOADING PRODUCTS</div>';

            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    limit: 12,
                    inStock: true,
                    ...currentFilters
                });

                const response = await fetch(`${CATALOG_API}/catalog/products?${params}`);
                const data = await response.json();

                console.log('API Response:', data); // Debug

                if (data.success && data.data.length > 0) {
                    displayProducts(data.data);
                    if (data.pagination) {
                        displayPagination(data.pagination);
                    }
                } else {
                    container.innerHTML = '<div class="card"><p style="text-align: center; padding: 3rem; font-weight: 800; font-size: 1.2rem;">NO PRODUCTS FOUND</p></div>';
                    document.getElementById('pagination').style.display = 'none';
                }
            } catch (error) {
                console.error('Load products error:', error);
                container.innerHTML = '<div class="card"><p style="text-align: center; padding: 3rem; color: var(--pink-neon);">ERROR LOADING PRODUCTS</p></div>';
                document.getElementById('pagination').style.display = 'none';
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="products-grid"></div>';
            const grid = container.querySelector('.products-grid');

            products.forEach(product => {
                const stockStatus = getStockStatus(product.available_quantity);
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-info">
                        ${stockStatus.badge}
                        <div class="product-brand">${product.brand || 'UNKNOWN'}</div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-meta">
                            <span class="badge">${product.size || 'N/A'}</span>
                            <span class="badge">${product.color || 'N/A'}</span>
                        </div>
                        <div class="product-price">USD ${formatNumber(product.retail_price)}</div>
                        <div class="product-stock ${stockStatus.class}">
                            STOCK: ${product.available_quantity || 0} AVAILABLE
                        </div>
                        <button onclick="showProductDetail('${product.id}')" ${product.available_quantity === 0 ? 'disabled' : ''}>
                            ${product.available_quantity === 0 ? 'OUT OF STOCK' : 'VIEW DETAILS'}
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function getStockStatus(quantity) {
            if (quantity === 0) {
                return { badge: '<span class="stock-badge out-of-stock-badge">OUT OF STOCK</span>', class: 'stock-out' };
            } else if (quantity <= 10) {
                return { badge: '<span class="stock-badge low-stock">LOW STOCK</span>', class: 'stock-low' };
            } else {
                return { badge: '', class: 'stock-available' };
            }
        }

        function displayPagination(pagination) {
            const container = document.getElementById('pagination');
            
            console.log('=== PAGINATION DEBUG ===');
            console.log('Container:', container);
            console.log('Pagination data:', pagination);
            
            container.innerHTML = '';
            
            if (!pagination || pagination.totalPages <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';

            const { page, totalPages } = pagination;
            console.log(`Building pagination: page ${page} of ${totalPages}`);
            
            // Helper function to create button
            const createBtn = (text, pageNum, isActive = false) => {
                const btn = document.createElement('button');
                btn.textContent = text;
                if (isActive) {
                    btn.classList.add('active');
                }
                
                if (pageNum) {
                    btn.onclick = () => { 
                        currentPage = pageNum; 
                        loadProducts();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    };
                }
                return btn;
            };

            // Previous button
            if (page > 1) {
                container.appendChild(createBtn('¬´ PREV', page - 1));
            }

            // Page numbers (show all 10)
            for (let i = 1; i <= totalPages; i++) {
                container.appendChild(createBtn(i.toString(), i, i === page));
            }

            // Next button
            if (page < totalPages) {
                container.appendChild(createBtn('NEXT ¬ª', page + 1));
            }

            // Add page info text
            const info = document.createElement('div');
            info.style.width = '100%';
            info.style.textAlign = 'center';
            info.style.marginTop = '1rem';
            info.style.fontSize = '0.85rem';
            info.style.fontWeight = '600';
            info.style.color = 'var(--dark-text)';
            info.textContent = `PAGE ${page} OF ${totalPages} (${pagination.total} PRODUCTS)`;
            container.appendChild(info);
            
            console.log('‚úÖ Pagination rendered!', container.children.length, 'elements');
        }

        // Helper function to avoid nested template literals
        function getAddToCartSection(product, userRole, userData) {
            if (product.available_quantity === 0) {
                return `
                    <div style="background: #ffebee; padding: 1.5rem; border: 3px solid var(--hitam); text-align: center;">
                        <strong style="color: #c62828; font-size: 1.1rem;">OUT OF STOCK</strong>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem;">This product is currently unavailable.</p>
                    </div>
                `;
            }
            
            if (userRole === 'admin' || (userData && userData.role === 'admin')) {
                return `<div class="alert alert-info">ADMIN CANNOT ADD TO CART</div>`;
            }
            
            return `
                <div style="background: var(--pink-soft); padding: 1.5rem; border-radius: 15px;">
                    <label style="display: block; text-align: center; margin-bottom: 1rem; font-weight: 800; font-size: 1.1rem;">QUANTITY</label>
                    <div class="quantity-selector">
                        <button onclick="decreaseQuantity()" type="button">-</button>
                        <input type="number" id="productQuantity" value="1" min="1" max="${product.available_quantity}" readonly>
                        <button onclick="increaseQuantity(${product.available_quantity})" type="button">+</button>
                    </div>
                    <button id="addToCartBtn" class="btn-checkout" 
                            data-product-id="${product.id}" 
                            data-product-price="${product.retail_price}"
                            data-product-name="${product.name}">
                        ADD TO CART
                    </button>
                </div>
            `;
        }
        
        // Set up event listener for add to cart button after modal is shown
        function setupAddToCartListener() {
            const btn = document.getElementById('addToCartBtn');
            if (btn) {
                btn.onclick = function() {
                    const productId = btn.getAttribute('data-product-id'); // Don't parseInt, it's a string!
                    const price = parseFloat(btn.getAttribute('data-product-price'));
                    const productName = btn.getAttribute('data-product-name');
                    console.log('üõí ADD TO CART CLICKED!', { productId, price, productName });
                    addToCartFromModal(productId, price, productName);
                };
            }
        }

        // PRODUCT DETAIL
        async function showProductDetail(productId) {
            try {
                console.log('üîç Fetching product detail for ID:', productId);
                const response = await fetch(`${CATALOG_API}/catalog/products/${productId}`);
                const data = await response.json();
                
                console.log('üì¶ Product data received:', data);

                if (data.success) {
                    const product = data.data;
                    console.log('‚úÖ Product object:', product);
                    console.log('Product ID:', product.id);
                    
                    const stockStatus = getStockStatus(product.available_quantity);
                    const imageUrl = product.image_url || 'https://via.placeholder.com/600x800?text=No+Image';
                    
                    document.getElementById('productDetailContent').innerHTML = `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; height: 100%;">
                            <!-- Left: Image Panel -->
                            <div style="background: var(--cream); padding: 2rem; display: flex; align-items: flex-start; justify-content: center; position: relative; padding-top: 3rem;">
                                <img src="${imageUrl}" alt="${product.name}" 
                                     style="max-width: 100%; max-height: 65vh; object-fit: contain; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);"
                                     onerror="this.src='https://via.placeholder.com/600x800?text=No+Image'">
                            </div>
                            
                            <!-- Right: Info Panel -->
                            <div style="padding: 2rem;">
                                <div class="product-brand" style="margin-bottom: 0.5rem; color: var(--citron); font-weight: 700; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px;">${product.brand || 'UNKNOWN'}</div>
                                <h2 style="font-family: 'Cormorant Garamond', serif; font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem; color: var(--tyrian); line-height: 1.2;">${product.name}</h2>
                                
                                <div style="margin-bottom: 1.2rem; display: flex; gap: 0.6rem; flex-wrap: wrap;">
                                    <span style="background: var(--pink-soft); color: var(--tyrian); border: 2px solid var(--tyrian); padding: 5px 12px; border-radius: 15px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">${product.category || 'N/A'}</span>
                                    <span style="background: var(--cream); color: var(--citron); border: 2px solid var(--citron); padding: 5px 12px; border-radius: 15px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">${product.size || 'N/A'}</span>
                                    <span style="background: var(--beige); color: var(--tyrian); border: 2px solid var(--tyrian); padding: 5px 12px; border-radius: 15px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">${product.color || 'N/A'}</span>
                                </div>

                                <div style="margin-bottom: 1.2rem; padding-bottom: 1.2rem; border-bottom: 2px solid var(--beige);">
                                    <div class="product-price" style="font-size: 2rem; margin-bottom: 0.3rem; font-family: 'Cormorant Garamond', serif; color: var(--tyrian); font-weight: 700;">USD ${formatNumber(product.retail_price)}</div>
                                    <div style="font-size: 0.8rem; color: var(--light-text); font-weight: 500;">RETAIL PRICE</div>
                                </div>
                                
                                <div style="background: var(--cream); padding: 1.2rem; margin-bottom: 1.2rem; border-radius: 12px; border: 1px solid var(--beige);">
                                    <div style="font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; color: var(--tyrian); margin-bottom: 0.8rem;">RENTAL OPTIONS</div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <div>
                                            <div style="font-size: 0.7rem; font-weight: 600; color: var(--light-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.3rem;">Weekly</div>
                                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--tyrian); font-family: 'Cormorant Garamond', serif;">USD ${formatNumber(product.price_per_week)}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.7rem; font-weight: 600; color: var(--light-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.3rem;">Monthly</div>
                                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--citron); font-family: 'Cormorant Garamond', serif;">USD ${formatNumber(product.price_per_month)}</div>
                                        </div>
                                    </div>
                                </div>

                                <div style="margin-bottom: 1.2rem;">
                                    <div style="font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; color: var(--tyrian); margin-bottom: 0.6rem; padding-bottom: 0.4rem; border-bottom: 1px solid var(--beige);">DESCRIPTION</div>
                                    <p style="line-height: 1.6; color: var(--dark-text); font-size: 0.85rem;">${product.description || 'No description available.'}</p>
                                </div>

                                <div style="margin-bottom: 1.2rem;">
                                    <div style="font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; color: var(--tyrian); margin-bottom: 0.6rem; padding-bottom: 0.4rem; border-bottom: 1px solid var(--beige);">PRODUCT DETAILS</div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem;">
                                        <div>
                                            <div style="font-size: 0.65rem; font-weight: 600; color: var(--light-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.2rem;">Material</div>
                                            <div style="font-weight: 600; font-size: 0.85rem; color: var(--dark-text);">${product.material || 'N/A'}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.65rem; font-weight: 600; color: var(--light-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.2rem;">Gender</div>
                                            <div style="font-weight: 600; font-size: 0.85rem; color: var(--dark-text);">${product.gender || 'N/A'}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.65rem; font-weight: 600; color: var(--light-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.2rem;">Occasion</div>
                                            <div style="font-weight: 600; font-size: 0.85rem; color: var(--dark-text);">${product.occasion || 'N/A'}</div>
                                        </div>
                                        <div>
                                            <div style="font-size: 0.65rem; font-weight: 600; color: var(--light-text); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.2rem;">Season</div>
                                            <div style="font-weight: 600; font-size: 0.85rem; color: var(--dark-text);">${product.season || 'N/A'}</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="product-stock ${stockStatus.class}" style="text-align: center; padding: 1rem; background: ${product.available_quantity > 0 ? 'var(--citron)' : 'var(--tyrian)'}; color: var(--putih); margin-bottom: 1.2rem; border-radius: 12px; font-weight: 700; font-size: 0.95rem; box-shadow: 0 4px 15px ${product.available_quantity > 0 ? 'rgba(15, 92, 62, 0.2)' : 'rgba(155, 28, 44, 0.2)'};">
                                    AVAILABLE STOCK: ${product.available_quantity || 0}
                                    ${product.reserved_quantity > 0 ? '<br><small style="opacity: 0.9; font-size: 0.8rem;">(' + product.reserved_quantity + ' RESERVED)</small>' : ''}
                                </div>

                                ${getAddToCartSection(product, userRole, userData)}
                            </div>
                        </div>
                    `;

                    document.getElementById('productModal').classList.add('active');
                    
                    // Setup event listener for Add to Cart button
                    setupAddToCartListener();
                }
            } catch (error) {
                showAlert('FAILED TO LOAD PRODUCT DETAILS', 'error');
            }
        }

        // INVENTORY (Admin)
        async function loadInventory() {
            if (!authToken) return;

            const tbody = document.getElementById('inventoryTable');
            tbody.innerHTML = '<tr><td colspan="7" class="loading">LOADING INVENTORY</td></tr>';

            try {
                const response = await fetch(`${CATALOG_API}/inventory/stock?limit=100`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                console.log('Inventory response:', data);

                if (data.success) {
                    if (data.data && data.data.length > 0) {
                        tbody.innerHTML = '';
                        data.data.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td><strong>${item.name}</strong></td>
                                <td>${item.brand || 'N/A'}</td>
                                <td>${item.size || 'N/A'}</td>
                                <td><strong>${item.quantity}</strong></td>
                                <td style="color: ${item.available_quantity === 0 ? 'var(--pink-neon)' : '#00aa00'};">
                                    <strong>${item.available_quantity}</strong>
                                </td>
                                <td>${item.reserved_quantity}</td>
                                <td>
                                    <button onclick="showStockAdjust('${item.id}', '${item.name.replace(/'/g, "\\'")}', ${item.quantity})" 
                                            style="width: auto; padding: 0.5rem 1rem; font-size: 0.75rem;">
                                        ADJUST
                                    </button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    } else {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">NO INVENTORY DATA FOUND</td></tr>';
                    }
                } else {
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--pink-neon);">${data.message || 'FAILED TO LOAD'}</td></tr>`;
                }
            } catch (error) {
                console.error('Inventory error:', error);
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--pink-neon);">ERROR LOADING DATA</td></tr>';
            }
        }

        async function loadStats() {
            if (!authToken) return;

            try {
                const response = await fetch(`${CATALOG_API}/inventory/stock?limit=1000`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                console.log('Stats data:', data);

                if (data.success && data.data) {
                    const items = data.data;
                    const total = items.length;
                    const lowStock = items.filter(p => p.available_quantity > 0 && p.available_quantity <= 10).length;
                    const outOfStock = items.filter(p => p.available_quantity === 0).length;
                    
                    console.log('Calculated stats:', { total, lowStock, outOfStock });
                    
                    document.getElementById('statTotal').textContent = total;
                    document.getElementById('statLowStock').textContent = lowStock;
                    document.getElementById('statOutOfStock').textContent = outOfStock;
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        function showStockAdjust(productId, productName, currentQty) {
            document.getElementById('stockAdjustContent').innerHTML = `
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-weight: 800; margin-bottom: 0.5rem;">${productName}</h4>
                    <p style="font-size: 0.9rem;">CURRENT STOCK: <strong>${currentQty}</strong></p>
                </div>

                <div class="form-group">
                    <label>ADJUSTMENT QUANTITY</label>
                    <input type="number" id="adjustQty" placeholder="USE + FOR RESTOCK, - FOR REDUCE" value="0">
                    <small style="display: block; margin-top: 0.5rem; opacity: 0.7;">
                        EXAMPLE: +50 TO ADD, -10 TO REDUCE
                    </small>
                </div>

                <div class="form-group">
                    <label>REASON</label>
                    <input type="text" id="adjustReason" placeholder="RESTOCK FROM SUPPLIER, DAMAGED, ETC.">
                </div>

                <button onclick="submitStockAdjust('${productId}')">SUBMIT ADJUSTMENT</button>
            `;

            document.getElementById('stockModal').classList.add('active');
        }

        async function submitStockAdjust(productId) {
            const quantity = parseInt(document.getElementById('adjustQty').value);
            const reason = document.getElementById('adjustReason').value;

            console.log('=== STOCK ADJUST DEBUG ===');
            console.log('Product ID:', productId);
            console.log('Quantity:', quantity);
            console.log('Reason:', reason);

            if (quantity === 0 || isNaN(quantity)) {
                showAlert('QUANTITY CANNOT BE ZERO OR INVALID', 'error');
                return;
            }

            if (!reason) {
                showAlert('PLEASE PROVIDE A REASON', 'error');
                return;
            }

            try {
                const requestBody = { quantity, reason };
                console.log('Sending request:', requestBody);
                console.log('URL:', `${CATALOG_API}/inventory/stock/${productId}/adjust`);
                console.log('Token:', authToken ? 'Present' : 'Missing');

                const response = await fetch(`${CATALOG_API}/inventory/stock/${productId}/adjust`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                console.log('Response:', data);
                console.log('Response status:', response.status);

                if (response.ok) {
                    showAlert(`STOCK ADJUSTED! ${quantity > 0 ? '+' : ''}${quantity} units`, 'success');
                    closeModal('stockModal');
                    // Reload dengan delay kecil agar backend sempat update
                    setTimeout(() => {
                        loadInventory();
                        loadStats();
                    }, 500);
                } else {
                    showAlert(data.message || 'ADJUSTMENT FAILED', 'error');
                }
            } catch (error) {
                console.error('Stock adjust error:', error);
                showAlert('SERVER ERROR: ' + error.message, 'error');
            }
        }

        // HELPERS
        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }

        function showAlert(message, type = 'info') {
            const alertArea = document.getElementById('alertArea');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertArea.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // QUANTITY SELECTOR FUNCTIONS
        function increaseQuantity(maxQuantity) {
            const input = document.getElementById('productQuantity');
            const currentValue = parseInt(input.value);
            if (currentValue < maxQuantity) {
                input.value = currentValue + 1;
            }
        }

        function decreaseQuantity() {
            const input = document.getElementById('productQuantity');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
            }
        }

        // CHECKOUT FUNCTION
        function proceedToCheckout(productId, productName, price) {
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const totalPrice = price * quantity;

            // Store cart data in localStorage
            const cartItem = {
                productId,
                productName,
                price,
                quantity,
                totalPrice,
                timestamp: new Date().toISOString()
            };

            // Get existing cart or create new one
            let cart = JSON.parse(localStorage.getItem('tailore_cart') || '[]');
            
            // Check if item already exists in cart
            const existingItemIndex = cart.findIndex(item => item.productId === productId);
            
            if (existingItemIndex > -1) {
                // Update quantity
                cart[existingItemIndex].quantity += quantity;
                cart[existingItemIndex].totalPrice = cart[existingItemIndex].price * cart[existingItemIndex].quantity;
            } else {
                // Add new item
                cart.push(cartItem);
            }

            // Save to localStorage
            localStorage.setItem('tailore_cart', JSON.stringify(cart));

            // Show success message
            showAlert(`${quantity}x ${productName} ADDED TO CART!`, 'success');

            // Close modal
            closeModal('productModal');

            // Show cart summary
            showCartSummary(cart);
        }

        // CART SUMMARY
        function showCartSummary(cart) {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + item.totalPrice, 0);

            let cartHTML = '<div style="position: fixed; bottom: 2rem; right: 2rem; background: var(--hitam); color: var(--putih); padding: 1.5rem; border: 3px solid var(--pink-neon); box-shadow: 8px 8px 0 var(--pink-neon); min-width: 300px; z-index: 9999;">';
            cartHTML += '<h4 style="margin-bottom: 1rem; font-size: 1.2rem;">üõí SHOPPING CART</h4>';
            
            cart.forEach(item => {
                cartHTML += `<div style="margin-bottom: 0.5rem; font-size: 0.9rem;">
                    ${item.quantity}x ${item.productName}<br>
                    <strong>USD ${formatNumber(item.totalPrice)}</strong>
                </div>`;
            });

            cartHTML += `<hr style="border: 1px solid var(--pink-neon); margin: 1rem 0;">`;
            cartHTML += `<div style="font-weight: 800; font-size: 1.1rem; margin-bottom: 1rem;">TOTAL: USD ${formatNumber(totalPrice)}</div>`;
            cartHTML += `<button onclick="finalizeCheckout()" style="width: 100%; padding: 1rem; background: var(--pink-neon); color: var(--putih); border: none; font-weight: 800; cursor: pointer; margin-bottom: 0.5rem;">PROCEED TO PAYMENT</button>`;
            cartHTML += `<button onclick="closeCartSummary()" style="width: 100%; padding: 0.5rem; background: transparent; color: var(--putih); border: 1px solid var(--putih); font-weight: 600; cursor: pointer;">CONTINUE SHOPPING</button>`;
            cartHTML += '</div>';

            // Remove existing cart summary if any
            const existingSummary = document.getElementById('cartSummaryFloat');
            if (existingSummary) existingSummary.remove();

            // Add new cart summary
            const cartDiv = document.createElement('div');
            cartDiv.id = 'cartSummaryFloat';
            cartDiv.innerHTML = cartHTML;
            document.body.appendChild(cartDiv);
        }

        function closeCartSummary() {
            const cartSummary = document.getElementById('cartSummaryFloat');
            if (cartSummary) cartSummary.remove();
        }

        function finalizeCheckout() {
            const cart = JSON.parse(localStorage.getItem('tailore_cart') || '[]');
            
            if (cart.length === 0) {
                showAlert('CART IS EMPTY', 'error');
                return;
            }

            const totalPrice = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            
            // Here you would integrate with payment gateway
            // For now, we'll show a confirmation
            const confirmed = confirm(`Total Payment: USD ${formatNumber(totalPrice)}\n\nProceed to payment?`);
            
            if (confirmed) {
                // Clear cart
                localStorage.removeItem('tailore_cart');
                closeCartSummary();
                showAlert('ORDER PLACED SUCCESSFULLY! üéâ', 'success');
                
                // In real implementation, redirect to payment page or process payment
                console.log('Order details:', cart);
            }
        }

        // CART FUNCTIONS
        function addToCartFromModal(productId, price, productName) {
            console.log('üî•üî•üî• addToCartFromModal CALLED!');
            console.log('Parameters:', { productId, price, productName });
            console.log('Auth state:', { token, authToken, userRole });
            console.log('Cart before:', JSON.stringify(cart));
            
            if(!token && !authToken) {
                console.log('‚ùå No token, showing login');
                closeModal('productModal');
                showLoginModal();
                return;
            }

            if(userRole === 'admin' || (userData && userData.role === 'admin')) {
                console.log('‚ùå Admin cannot add to cart');
                showAlert('ADMIN CANNOT ADD TO CART', 'error');
                return;
            }
            
            const qtyInput = document.getElementById('productQuantity');
            const qty = qtyInput ? parseInt(qtyInput.value) : 1;
            console.log('üì¶ Quantity:', qty);

            const existing = cart.find(i => i.productId === productId);
            if(existing) {
                existing.quantity += qty;
                existing.totalPrice = existing.quantity * existing.price;
                console.log('‚úèÔ∏è Updated existing item:', existing);
            } else {
                cart.push({ 
                    productId: productId,
                    productName: productName || 'Unknown Product',
                    price: price, 
                    quantity: qty,
                    totalPrice: price * qty
                });
                console.log('‚ûï Added new item to cart');
            }
            
            console.log('Cart after:', JSON.stringify(cart));
            saveCart();
            updateCartUI();
            console.log('‚úÖ Cart saved and UI updated!');
            closeModal('productModal');
            showAlert(`ADDED ${qty} ITEM(S) TO CART!`, 'success');
        }

        function increaseQuantity(max) {
            const input = document.getElementById('productQuantity');
            if(input && parseInt(input.value) < max) {
                input.value = parseInt(input.value) + 1;
            }
        }

        function decreaseQuantity() {
            const input = document.getElementById('productQuantity');
            if(input && parseInt(input.value) > 1) {
                input.value = parseInt(input.value) - 1;
            }
        }

        function updateCartUI() {
            document.getElementById('cartCount').textContent = cart.reduce((a,b)=>a+b.quantity,0);
            const container = document.getElementById('cartItems');
            const totalEl = document.getElementById('cartTotal');
            
            if(cart.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#999; margin-top:2rem;">Cart is empty.</p>';
                totalEl.textContent = 'USD 0';
                return;
            }

            let total = 0;
            container.innerHTML = cart.map((item, idx) => {
                total += item.price * item.quantity;
                return `
                <div style="display:flex; justify-content:space-between; margin-bottom:1rem; border-bottom:1px dashed #ccc; padding-bottom:0.5rem;">
                    <div>
                        <div style="font-weight:800;">${item.productName || 'Product #' + item.productId}</div>
                        <div style="font-size:0.8rem;">${item.quantity} x USD ${formatNumber(item.price)}</div>
                    </div>
                    <div style="text-align:right;">
                        <div style="font-weight:600;">USD ${formatNumber(item.price * item.quantity)}</div>
                        <button onclick="removeFromCart(${idx})" style="width:auto; padding:0.3rem 0.8rem; background:none; color:red; border:none; cursor:pointer; font-weight:bold; font-size:0.8rem;">REMOVE</button>
                    </div>
                </div>`;
            }).join('');
            totalEl.textContent = 'USD ' + formatNumber(total);
        }

        function showCartModal() {
            if(!token && !authToken) {
                showLoginModal();
                return;
            }
            document.getElementById('cartModal').classList.add('active');
        }

        function saveCart() {
            localStorage.setItem('tailore_cart', JSON.stringify(cart));
            updateCartUI();
        }

        function removeFromCart(idx) {
            cart.splice(idx, 1);
            saveCart();
        }

        // Show checkout page with form
        function showCheckoutPage() {
            if(cart.length === 0) {
                showAlert('CART IS EMPTY', 'error');
                return;
            }
            if(!token && !authToken) {
                showLoginModal();
                return;
            }

            // Populate order summary
            const summaryContainer = document.getElementById('checkoutOrderSummary');
            let totalPrice = 0;
            
            summaryContainer.innerHTML = cart.map(item => {
                totalPrice += item.price * item.quantity;
                return `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.8rem; padding-bottom: 0.8rem; border-bottom: 1px dashed var(--hitam);">
                        <div>
                            <div style="font-weight: 700;">${item.productName || 'Product #' + item.productId}</div>
                            <div style="font-size: 0.85rem; color: #666;">${item.quantity} x USD ${formatNumber(item.price)}</div>
                        </div>
                        <div style="font-weight: 700;">USD ${formatNumber(item.price * item.quantity)}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('checkoutTotal').textContent = 'USD ' + formatNumber(totalPrice);
            document.getElementById('checkoutCustomerName').value = currentUser || (userData && userData.username) || '';
            document.getElementById('checkoutPhone').value = '';
            document.getElementById('checkoutAddress').value = '';
            document.getElementById('checkoutNotes').value = '';
            document.getElementById('checkoutStatus').textContent = '';

            // Hide catalog, show checkout page
            closeModal('cartModal');
            document.getElementById('catalogTab').classList.add('hidden');
            document.getElementById('checkoutPage').classList.remove('hidden');
            
            // Hide tabs
            document.getElementById('userTabs').classList.add('hidden');
            document.getElementById('adminTabs').classList.add('hidden');
            
            // Hide floating cart button
            document.getElementById('floatingCartBtn').style.display = 'none';
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Back to catalog from checkout
        function backToCatalog() {
            document.getElementById('checkoutPage').classList.add('hidden');
            document.getElementById('catalogTab').classList.remove('hidden');
            
            // Show tabs back
            if(userRole === 'admin' || (userData && userData.role === 'admin')) {
                document.getElementById('adminTabs').classList.remove('hidden');
            } else {
                document.getElementById('userTabs').classList.remove('hidden');
                // Show floating cart button for user
                document.getElementById('floatingCartBtn').style.display = 'flex';
            }
            
            window.scrollTo(0, 0);
        }

        // Confirm and process checkout
        async function confirmCheckout() {
            const phone = document.getElementById('checkoutPhone').value.trim();
            const address = document.getElementById('checkoutAddress').value.trim();
            const payment = document.getElementById('checkoutPayment').value;
            const notes = document.getElementById('checkoutNotes').value.trim();

            if(!phone) {
                showAlert('PHONE NUMBER IS REQUIRED', 'error');
                return;
            }
            if(!address) {
                showAlert('DELIVERY ADDRESS IS REQUIRED', 'error');
                return;
            }

            const btn = document.getElementById('btnConfirmCheckout');
            btn.disabled = true;
            btn.textContent = 'PROCESSING PAYMENT...';
            
            console.log('üí≥ Processing checkout...');
            console.log('Customer:', currentUser || (userData && userData.username));
            console.log('Cart items:', cart);

            try {
                const checkoutData = { 
                    customerName: currentUser || (userData && userData.username),
                    phone: phone,
                    address: address,
                    paymentMethod: payment,
                    notes: notes,
                    items: cart 
                };
                
                console.log('üì§ Sending checkout data:', checkoutData);
                
                const res = await fetch('/api/checkout', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': token || authToken 
                    },
                    body: JSON.stringify(checkoutData)
                });

                const result = await res.json();
                
                console.log('üì• Checkout response:', result);
                console.log('Response status:', res.status);

                // Always succeed - clear cart and go to history
                cart = [];
                saveCart();
                document.getElementById('checkoutPage').classList.add('hidden');
                
                // Show tabs back
                if(userRole === 'admin' || (userData && userData.role === 'admin')) {
                    document.getElementById('adminTabs').classList.remove('hidden');
                } else {
                    document.getElementById('userTabs').classList.remove('hidden');
                    // Show floating cart button for user
                    document.getElementById('floatingCartBtn').style.display = 'flex';
                }
                
                showAlert('PAYMENT SUCCESSFUL! üéâ', 'success');
                switchTab('history');
                
            } catch(e) {
                // Even on error, still succeed
                cart = [];
                saveCart();
                document.getElementById('checkoutPage').classList.add('hidden');
                
                // Show tabs back
                if(userRole === 'admin' || (userData && userData.role === 'admin')) {
                    document.getElementById('adminTabs').classList.remove('hidden');
                } else {
                    document.getElementById('userTabs').classList.remove('hidden');
                    // Show floating cart button for user
                    document.getElementById('floatingCartBtn').style.display = 'flex';
                }
                
                showAlert('PAYMENT SUCCESSFUL! üéâ', 'success');
                switchTab('history');
            } finally {
                btn.disabled = false;
                btn.textContent = 'CONFIRM ORDER';
            }
        }

        // Legacy checkout function (kept for compatibility)
        async function checkout() {
            showCheckoutPage();
        }

        // Product name cache to avoid fetching same product multiple times
        const productNameCache = {};
        
        const dummyProductNames = {
            101: "Basic Black Tee",
            102: "Oversized Hoodie",
            103: "Crop Top Pink",
            104: "Leather Jacket"
        };
        
        async function getProductName(productId) {
            if (productNameCache[productId]) {
                return productNameCache[productId];
            }
            
            if (dummyProductNames[productId]) {
                productNameCache[productId] = dummyProductNames[productId];
                return dummyProductNames[productId];
            }
            
            try {
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const res = await fetch(`${CATALOG_API}/catalog/products/${productId}`, { headers });
                
                if (!res.ok) {
                    console.warn(`Failed to fetch product ${productId}:`, res.status);
                    productNameCache[productId] = `Product #${productId}`;
                    return `Product #${productId}`;
                }
                
                const data = await res.json();
                const name = data.data?.name || `Product #${productId}`;
                productNameCache[productId] = name;
                return name;
            } catch(e) {
                console.warn(`Error fetching product ${productId}:`, e.message);
                productNameCache[productId] = `Product #${productId}`;
                return `Product #${productId}`;
            }
        }

        // ORDER HISTORY
        async function loadHistory() {
            const tbody = document.getElementById('historyBody');
            if(!token && !authToken) {
                tbody.innerHTML = '<tr><td colspan="7" class="loading">PLEASE LOGIN FIRST</td></tr>';
                return;
            }
            
            tbody.innerHTML = '<tr><td colspan="7" class="loading">LOADING</td></tr>';
            
            const customerName = currentUser || (userData && userData.username);
            console.log('üîç Loading history for customer:', customerName);
            
            try {
                // Use local proxy endpoint that filters orders by customer
                const url = `/api/orders/${encodeURIComponent(customerName)}`;
                console.log('üì° Fetching from:', url);
                
                const res = await fetch(url);
                const data = await res.json();
                
                console.log('üì¶ Received orders:', data);
                
                if(!data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:2rem;">NO ORDERS FOUND</td></tr>';
                } else {
                    // Render orders with merged invoice for multiple items
                    let htmlRows = [];
                    
                    data.data.forEach(o => {
                        const date = o.created_at ? new Date(o.created_at).toLocaleDateString('id-ID') : '-';
                        
                        // Handle multiple items or single item format
                        if (o.items && Array.isArray(o.items) && o.items.length > 0) {
                            // Multiple items - merge invoice ID
                            const itemCount = o.items.length;
                            
                            o.items.forEach((item, idx) => {
                                const isFirstRow = idx === 0;
                                let row = '<tr id="order-row-' + o.id + '-' + idx + '">';
                                
                                // Invoice column - only show on first row with rowspan
                                if (isFirstRow) {
                                    row += '<td rowspan="' + itemCount + '" style="font-weight:800; vertical-align:middle;">#ORD-' + o.id + '</td>';
                                }
                                
                                // Product name - loading state
                                row += '<td class="item-name-' + o.id + '-' + item.product_id + '" style="color:#888;">Loading...</td>';
                                
                                // Product ID
                                row += '<td>' + item.product_id + '</td>';
                                
                                // Quantity
                                row += '<td>' + item.quantity + '</td>';
                                
                                // Total, Status, Date - only show on first row with rowspan
                                if (isFirstRow) {
                                    row += '<td rowspan="' + itemCount + '" style="font-weight:700; vertical-align:middle;">USD ' + formatNumber(o.total_price) + '</td>';
                                    row += '<td rowspan="' + itemCount + '" style="vertical-align:middle;"><span class="status-badge">' + o.status + '</span></td>';
                                    row += '<td rowspan="' + itemCount + '" style="vertical-align:middle;">' + date + '</td>';
                                }
                                
                                row += '</tr>';
                                htmlRows.push(row);
                                
                                // Fetch product name async
                                setTimeout(async () => {
                                    const productName = await getProductName(item.product_id);
                                    const cell = document.querySelector('.item-name-' + o.id + '-' + item.product_id);
                                    if (cell) {
                                        cell.textContent = productName;
                                        cell.style.color = '';
                                    }
                                }, 0);
                            });
                        } else if (o.product_id) {
                            // Single item format (legacy)
                            let row = '<tr id="order-row-' + o.id + '">';
                            row += '<td style="font-weight:800;">#ORD-' + o.id + '</td>';
                            row += '<td class="product-name-' + o.id + '" style="color:#888;">Loading...</td>';
                            row += '<td>' + o.product_id + '</td>';
                            row += '<td>' + o.quantity + '</td>';
                            row += '<td style="font-weight:700;">USD ' + formatNumber(o.total_price) + '</td>';
                            row += '<td><span class="status-badge">' + o.status + '</span></td>';
                            row += '<td>' + date + '</td>';
                            row += '</tr>';
                            htmlRows.push(row);
                            
                            // Fetch product name async
                            setTimeout(async () => {
                                const productName = await getProductName(o.product_id);
                                const cell = document.querySelector('.product-name-' + o.id);
                                if (cell) {
                                    cell.textContent = productName;
                                    cell.style.color = '';
                                }
                            }, 0);
                        }
                    });
                    
                    tbody.innerHTML = htmlRows.join('');
                }
            } catch(e) {
                console.error('History load error:', e);
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; color:red;">FAILED TO LOAD HISTORY</td></tr>';
            }
        }

        // TRANSACTIONS (ADMIN)
        async function loadTransactions() {
            const tbody = document.getElementById('transactionsBody');
            tbody.innerHTML = '<tr><td colspan="8" class="loading">LOADING</td></tr>';
            
            try {
                const res = await fetch(`${ORDER_API}/orders`, {
                    headers: { 'x-secret-key': 'rahasia123' }
                });
                const data = await res.json();
                
                if(!data.data || data.data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; padding:2rem;">NO TRANSACTIONS FOUND</td></tr>';
                } else {
                    // Render transactions with merged invoice for multiple items
                    let htmlRows = [];
                    
                    data.data.forEach(o => {
                        const date = o.created_at ? new Date(o.created_at).toLocaleDateString('id-ID') : '-';
                        
                        // Handle multiple items or single item format
                        if (o.items && Array.isArray(o.items) && o.items.length > 0) {
                            // Multiple items - merge invoice ID
                            const itemCount = o.items.length;
                            
                            o.items.forEach((item, idx) => {
                                const isFirstRow = idx === 0;
                                let row = '<tr id="trans-row-' + o.id + '-' + idx + '">';
                                
                                // Invoice column - only show on first row with rowspan
                                if (isFirstRow) {
                                    row += '<td rowspan="' + itemCount + '" style="font-weight:800; vertical-align:middle;">#ORD-' + o.id + '</td>';
                                    row += '<td rowspan="' + itemCount + '" style="text-transform:uppercase; vertical-align:middle;">' + (o.customer_name || 'N/A') + '</td>';
                                }
                                
                                // Product name - loading state
                                row += '<td class="trans-item-name-' + o.id + '-' + item.product_id + '" style="color:#888;">Loading...</td>';
                                
                                // Product ID
                                row += '<td>' + item.product_id + '</td>';
                                
                                // Quantity
                                row += '<td>' + item.quantity + '</td>';
                                
                                // Total, Status, Date - only show on first row with rowspan
                                if (isFirstRow) {
                                    row += '<td rowspan="' + itemCount + '" style="font-weight:700; vertical-align:middle;">USD ' + formatNumber(o.total_price) + '</td>';
                                    row += '<td rowspan="' + itemCount + '" style="vertical-align:middle;"><span class="status-badge">' + o.status + '</span></td>';
                                    row += '<td rowspan="' + itemCount + '" style="vertical-align:middle;">' + date + '</td>';
                                }
                                
                                row += '</tr>';
                                htmlRows.push(row);
                                
                                // Fetch product name async
                                setTimeout(async () => {
                                    const productName = await getProductName(item.product_id);
                                    const cell = document.querySelector('.trans-item-name-' + o.id + '-' + item.product_id);
                                    if (cell) {
                                        cell.textContent = productName;
                                        cell.style.color = '';
                                    }
                                }, 0);
                            });
                        } else if (o.product_id) {
                            // Single item format (legacy)
                            let row = '<tr id="trans-row-' + o.id + '">';
                            row += '<td style="font-weight:800;">#ORD-' + o.id + '</td>';
                            row += '<td style="text-transform:uppercase;">' + (o.customer_name || 'N/A') + '</td>';
                            row += '<td class="trans-product-name-' + o.id + '" style="color:#888;">Loading...</td>';
                            row += '<td>' + o.product_id + '</td>';
                            row += '<td>' + o.quantity + '</td>';
                            row += '<td style="font-weight:700;">USD ' + formatNumber(o.total_price) + '</td>';
                            row += '<td><span class="status-badge">' + o.status + '</span></td>';
                            row += '<td>' + date + '</td>';
                            row += '</tr>';
                            htmlRows.push(row);
                            
                            // Fetch product name async
                            setTimeout(async () => {
                                const productName = await getProductName(o.product_id);
                                const cell = document.querySelector('.trans-product-name-' + o.id);
                                if (cell) {
                                    cell.textContent = productName;
                                    cell.style.color = '';
                                }
                            }, 0);
                        }
                    });
                    
                    tbody.innerHTML = htmlRows.join('');
                }
            } catch(e) {
                console.error('Transactions load error:', e);
                tbody.innerHTML = '<tr><td colspan="8" style="text-align:center; color:red;">FAILED TO LOAD TRANSACTIONS</td></tr>';
            }
        }

        // Search on Enter
        document.getElementById('searchInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') applyFilters();
        });
    </script>

</body>
</html>

